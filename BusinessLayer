/*
* This module will be bridge between frontend and db layer.
*/
var DbLayer = require("./DbLayer");


//var url = "mongodb://localhost:27017/surveydb";
var url = "mongodb://033a9a8889fb:27017/surveydb";
var dbName = "surveydb";

var collectionName = "team_member_happiness";
var collectionNameTeam = "team_happiness";
var collectionNameTeamMember = "team_member";
//var data = {name: "Thomas Junior4", team: "DevTeam3", date: "12July2018", rating: "happy"};

class BusinessLayer {

    // just wrapper method
    static insertTeamMemberData (data) {
        console.log("Business Layer, inserting team member data:"+collectionName);
        //insert data into db
        DbLayer.insertData(url,dbName,collectionName,data);
    
    }
    
    static updateTeamMemberData (data,myQuery) {
        console.log("Business Layer, updating team member data:"+collectionName);
        //insert data into db
        DbLayer.updateData(url,dbName,collectionName,data,myQuery);
    
    }

     static insertTeamData (data) {
        console.log("Business Layer, inserting team member data:"+collectionNameTeam);
        //insert data into db
        DbLayer.insertData(url,dbName,collectionNameTeam,data);
    
    }

    static insertNewTeamMember(data) {
        console.log("Business Layer, inserting new team member");
        DbLayer.insertData(url,dbName,collectionNameTeamMember,data);
    }
    static insertNewTeamMembers(data) {
        console.log("Business Layer, inserting new team members");
        DbLayer.insertMembers(url,dbName,collectionNameTeamMember,data);
    }

    

    static insertReminder(data) {
        console.log("Business Layer, inserting  Reminder:"+collectionName);
        //insert data into db
        //required format : var data = {name: "Sushi", team: "DevTeam08", date: dt, rating: NA, Reminder: 1};
        DbLayer.insertData(url,dbName,collectionName,data);
    }

    static getTeamMembers(callback) {
       DbLayer.readMultipleData (url,dbName,collectionNameTeamMember,function(data){
           var result = data;
           console.log(result);
           callback(result);
       });
    }

    static getTeamMemberHappinessByDateId(id,date,callback){
        DbLayer.readTeamMemberHappiness(id,date,url,dbName,collectionName,function(data){
           var result = data;
           console.log(result);
           callback(result);
       });
    }

     static getDataByTeamDate(dateFrom,dateTo,type,callback){
         var collection = collectionNameTeam;
         if(type === 'individual') {
             collection = collectionName;
         }
         console.log(collection);
        DbLayer.readHappiness(dateFrom,dateTo,url,dbName,collection,function(data){
           var result = data;
           console.log(result);
           callback(result);
       });
    }

    static getDailyReminderTimer() {
        var now = new Date();
        now.setHours(now.getHours()+13); // nz is 13 hours a head of UTC time
        var millisTill10 = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 10, 0, 0, 0) - now;
        if (millisTill10 < 0) {
            millisTill10 += 86400000; // it's after 10am, try 10am tomorrow.
        }
        return millisTill10;
    }

    static getTodayDate() {
        var now = new Date();
        
        var date = now.getDate();
        var month = now.getMonth()+1; //january is 0
        var year = now.getFullYear();

        if(date<10){
            date = '0'+date;
        }
        if(month<10){
            month = '0'+month;
        }

        var today = year+'-'+month+'-'+date;
        return today;

    }

}


module.exports = BusinessLayer;
